<!--
    Attention ! Il s'agit d'un fichier text en markdown, pour voir un aper√ßu, allez ici -> https://github.com/WildGoat07/projSQLS2/blob/master/README.MD
-->
# Projet SQL S2

Note : Notre table `session` s'appelle `quest_session` car `session` est un mot-cl√©. Pour utiliser les requ√™tes suivantes, il faudra 

## Requ√™tes :

1. > *"Quel pourcentage des questions portant sur le sport comporte au moins 3 bonnes r√©ponses propos√©es ?"*
    ```sql
    SELECT
        -- ici on r√©cup√®re le nombre de questions qui ont 3 r√©ponses justes
        COUNT(*) /
        (
            -- ici on r√©cup√®re le nombre total de questions du th√®me choisi
            SELECT
                COUNT(*)
            FROM
                question
                NATURAL JOIN theme
            WHERE
                theme.libelle_theme = "Sport"
        ) AS pourcentage
    FROM
        (
        -- cette requete r√©colte les questions qui ont 3 r√©ponses juste au th√®me donn√©
        SELECT
            *
        FROM
            question
            NATURAL JOIN theme
            NATURAL JOIN rep_proposee
        WHERE
            theme.libelle_theme = "Sport"
            AND rep_proposee.etat_rep = TRUE
        GROUP BY
            question.libelle
        HAVING
            COUNT(*) >= 3
        ) AS t; -- on doit obligatoirement donner un alias √† SQL pour les SELECT dans un FROM ¬Ø\_(„ÉÑ)_/¬Ø
    ```
1. > *"Quels sont, pour chaque question, les pourcentages de r√©ponses donn√©es correctes, der√©ponses donn√©es fausses, et de non-r√©ponses ?"*
    ```sql
    SELECT
        question.no_question AS numero,
        question.libelle AS libelle,
        (
            -- cette requ√™te r√©cup√®re le nombre de r√©ponses justes donn√©es
            SELECT
                COUNT(*)
            FROM
                rep_donnee
                NATURAL JOIN rep_proposee
            WHERE
                rep_donnee.no_question = numero
                AND rep_proposee.etat_rep = true
        ) /
        (
            -- cette requ√™te r√©cup√®re le nombre de r√©ponses donn√©es
            SELECT
                COUNT(*)
            FROM
                rep_donnee
                NATURAL JOIN rep_proposee
            WHERE
                rep_donnee.no_question = numero
        ) AS "bonne r√©ponses",
        (
            -- cette requ√™te r√©cup√®re le nombre de r√©ponses fausses donn√©es
            SELECT
                COUNT(*)
            FROM
                rep_donnee
                NATURAL JOIN rep_proposee
            WHERE
                rep_donnee.no_question = numero
                AND rep_proposee.etat_rep = false
        ) /
        (
            -- cette requ√™te r√©cup√®re le nombre de r√©ponses donn√©es
            SELECT
                COUNT(*)
            FROM
                rep_donnee
                NATURAL JOIN rep_proposee
            WHERE
                rep_donnee.no_question = numero
        ) AS "mauvaises r√©ponses",
        -- on fait "1-pourcentage" car sinon, on renvoie le pourcentage de r√©ponses donn√©es, or on veut les non-donn√©es
        1 - (
            -- cette requ√™te donne le nombre de r√©ponses donn√©es
            SELECT
                COUNT(*)
            FROM
                rep_donnee
            WHERE
                rep_donnee.no_question = numero
        ) /
        (
            -- cette requ√™te donne le nombre de fois que la question actuelle a √©t√© demand√©e
            SELECT
                COUNT(*)
            FROM
                quest_session AS current_session
            WHERE
                numero IN
                (
                    -- cette requ√™te donne la liste des questions du questionnaire de la session en cours
                    SELECT
                        se_compose.no_question
                    FROM
                        se_compose
                    WHERE current_session.no_quest = se_compose.no_quest
                )
        ) AS "non-r√©ponses"
    FROM
        question;
    ```
1. > *"Liste alphab√©tique des personnes ayant donn√© une r√©ponse correcte √† toutes les questions lors d‚Äôau moins une session."*
    ```sql
    SELECT
        -- formattage....
        CONCAT(UPPER(curr_pers.nom_pers), " ", curr_pers.prenom_pers) as Personnes
    FROM
        personne AS curr_pers
    WHERE
        -- on s√©lectionne toute les personne o√π cette sous requ√™te a trouv√© une session o√π toutes les r√©ponses sont justes
        EXISTS
        (
            -- cette sous-requ√™te donne toutes les sessions avec 100% de r√©ponses justes
            SELECT
                curr_session.no_session
            FROM
                quest_session AS curr_session
                NATURAL JOIN questionnaire AS curr_questionnaire
            WHERE
                -- on lie √† notre personne actuelle
                curr_session.no_pers = curr_pers.no_pers
                -- on v√©rifie qu'il n'y a aucune r√©ponse non valid√©e
                AND NOT EXISTS
                (
                    -- cette requ√™te s√©lectionne toutes les r√©ponses fausse ou non-r√©pondues
                    SELECT
                        rep_donnee.no_question
                    FROM
                        rep_donnee
                        NATURAL JOIN rep_proposee
                        -- on fait un RIGHT JOIN car on veut garder les questions o√π on n'a pas de r√©ponses (null)
                        RIGHT JOIN se_compose USING(no_question)
                    WHERE
                        -- on se lie au questionnaire actuel de notre session
                        se_compose.no_quest = curr_questionnaire.no_quest
                        AND
                        -- s'il s'agit d'une r√©ponse donn√©e √† la bonne session et qu'elle est fausse
                        ( ( rep_donnee.no_session = curr_session.no_session AND rep_proposee.etat_rep = false)
                        -- ou bien que cette r√©ponse est absente
                            OR rep_donnee.no_session IS null)
                )
        )
    -- trie par rapport au nom et au pr√©nom
    ORDER BY curr_pers.nom_pers, curr_pers.prenom_pers;
    ```
1. > *"Quels utilisateurs ont r√©pondu √† des questionnaires portant sur tous les th√®mes pour lesquels il existe des questionnaires ?"*
    ```sql
    SELECT
        -- formattage....
        CONCAT(personne.nom_pers, " ", personne.prenom_pers) AS Personnes
    FROM
        personne
        NATURAL JOIN quest_session
        NATURAL JOIN questionnaire
    -- on s√©lectionne tous les questionnaires r√©pondus pour chaque personne
    GROUP BY personne.no_pers
    -- si on a autant de th√®mes r√©pondus diff√©rents qu'il existe de th√®mes diff√©rents
    HAVING COUNT(DISTINCT questionnaire.no_theme) = 
        (
            SELECT
                -- le nombre de th√®mes diff√©rents possibles √† r√©pondre
                COUNT(DISTINCT questionnaire.no_theme)
            FROM
                questionnaire
        );
    ```
1. > *"Quels utilisateurs ont r√©pondu au moins une fois √† tous les questionnaires ?"*
    ```sql
    -- approche arithm√©tique
    SELECT
        CONCAT(UPPER(personne.nom_pers), " ", personne.prenom_pers) AS Personnes
    FROM
        personne
        NATURAL JOIN quest_session
    GROUP BY personne.no_pers
    HAVING COUNT(DISTINCT quest_session.no_quest) =
    (
        SELECT
            COUNT(*)
        FROM
            questionnaire
    )
    ```
1. > *"Score de la session num√©ro 23."*
    
    **Note** : On va mettre comme r√®gle : une bonne r√©ponse = 2 pts, une mauvaise r√©ponse = -1 pt, une non-r√©ponse = 0 pts pour pimenter les choses üî•
    ```sql
    SELECT
        bonnes_reponses.val AS `R√©ponses justes`, mauvaises_reponses.val AS `R√©ponses fausses`, bonnes_reponses.val * 2 - mauvaises_reponses.val AS Score
    FROM
        (
            SELECT
                COUNT(*) AS val
            FROM
                rep_donnee
                NATURAL JOIN rep_proposee
            WHERE
                rep_donnee.no_session = 18
                AND rep_proposee.etat_rep = true
        ) AS bonnes_reponses,
        (
            SELECT
                COUNT(*) AS val
            FROM
                rep_donnee
                NATURAL JOIN rep_proposee
            WHERE
                rep_donnee.no_session = 18
                AND rep_proposee.etat_rep = false
        ) AS mauvaises_reponses
    ```
1. > *"Quel est le pourcentage des personnes ayant particip√© √† au moins 1 session qui ont obtenu un score sup√©rieur √† 0 lors d‚Äôau moins 1 session ?"*

    Pareil, on calcul le score de la m√™me mani√®re qu'√† la question pr√©c√©dente
    ```sql
    SELECT
        pers.val / total.val AS Pourcentage
    FROM
        (
            -- le total des personnes ayant jou√©
            SELECT
                COUNT(DISTINCT quest_session.no_pers) AS val
            FROM
                quest_session
        ) AS total,
        (
            SELECT
                COUNT(DISTINCT curr_session.no_pers) AS val
            FROM
                quest_session AS curr_session
            WHERE
            -- calcul du score (copie pasta de la question pr√©c√©dente)
            0 < (
                    -- le nombre de bonnes r√©ponses
                    SELECT
                        COUNT(*)
                    FROM
                        rep_donnee
                        NATURAL JOIN rep_proposee
                    WHERE
                        rep_donnee.no_session = curr_session.no_session
                        AND rep_proposee.etat_rep = true
                ) * 2 -  -- on multiplie par deux, et on enl√®ve le nombre de mauvaises r√©ponses pour le score
                (
                    SELECT
                        COUNT(*)
                    FROM
                        rep_donnee
                        NATURAL JOIN rep_proposee
                    WHERE
                        rep_donnee.no_session = curr_session.no_session
                        AND rep_proposee.etat_rep = false
                )
        ) AS pers
    ```
1. > *"Quelles personnes ont r√©alis√©s les 10 meilleurs scores ?"*
    ```sql
    ```
1. > *"Existe-t-il des r√©ponses donn√©es enregistr√©es ne correspondant pas √† une question pos√©e ?"*
    ```sql
    ```